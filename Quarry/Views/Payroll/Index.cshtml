@model QuarryManagementSystem.ViewModels.PayrollListViewModel
@{
    ViewData["Title"] = "Payroll";
}

<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">Payroll</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index","Dashboard")">Home</a></li>
                    <li class="breadcrumb-item active">Payroll</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid">
        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div class="alert alert-danger">@Model.ErrorMessage</div>
        }

        <div class="card card-outline card-primary">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="card-title mb-0">Filters</h3>
                <a class="btn btn-success btn-sm" href="@Url.Action("Create","Payroll")">
                    <i class="fas fa-plus"></i> New Payroll
                </a>
            </div>
            <div class="card-body">
                <form method="get" asp-action="Index" asp-controller="Payroll" class="form-inline">
                    <div class="form-group mr-2">
                        <input name="searchTerm" value="@Model.SearchTerm" class="form-control" placeholder="Search run number..." />
                    </div>
                    <div class="form-group mr-2">
                        <select name="status" class="form-control" asp-for="SelectedStatus" asp-items="Model.Statuses"></select>
                    </div>
                    <div class="form-group mr-2">
                        <select name="year" class="form-control" asp-for="SelectedYear" asp-items="Model.Years"></select>
                    </div>
                    <div class="form-group mr-2">
                        <select name="month" class="form-control" asp-for="SelectedMonth" asp-items="Model.Months"></select>
                    </div>
                    <button type="submit" class="btn btn-primary">Apply</button>
                </form>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-4">
                <div class="info-box">
                    <span class="info-box-icon bg-info"><i class="fas fa-list"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">Total Runs</span>
                        <span class="info-box-number">@Model.TotalCount</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="info-box">
                    <span class="info-box-icon bg-success"><i class="fas fa-coins"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">Total Net Pay</span>
                        <span class="info-box-number">@Model.TotalNetPay.ToString("C")</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="info-box">
                    <span class="info-box-icon bg-warning"><i class="fas fa-users"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">Avg Employees</span>
                        <span class="info-box-number">@Model.AverageEmployees.ToString("N0")</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Payroll Runs</h3>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Run #</th>
                                <th>Payment Month</th>
                                <th class="text-right">Employees</th>
                                <th class="text-right">Gross Pay</th>
                                <th class="text-right">Net Pay</th>
                                <th>Status</th>
                                <th class="text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                        @if (Model.PayrollRuns.Any())
                        {
                            foreach (var pr in Model.PayrollRuns)
                            {
                                <tr>
                                    <td>@pr.RunNumber</td>
                                    <td>@pr.PaymentMonth.ToString("yyyy-MM")</td>
                                    <td class="text-right">@pr.TotalEmployees</td>
                                    <td class="text-right">@pr.GrossPay.ToString("N2")</td>
                                    <td class="text-right">@pr.NetPay.ToString("N2")</td>
                                    <td>
                                        <span class="badge badge-@(pr.Status == "Processed" ? "info" : pr.Status == "Paid" ? "success" : "secondary")">
                                            @pr.Status
                                        </span>
                                    </td>
                                    <td class="text-right">
                                        <a class="btn btn-sm btn-primary" href="@Url.Action("Details","Payroll", new { id = pr.Id })">Details</a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="7" class="text-center p-4 text-muted">No payroll runs found.</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer">
                <nav aria-label="Payroll pagination">
                    <ul class="pagination mb-0">
                        <li class="page-item @(Model.HasPreviousPage ? "" : "disabled")">
                            <a class="page-link" href="@Url.Action("Index","Payroll", new { searchTerm = Model.SearchTerm, status = Model.SelectedStatus, year = Model.SelectedYear, month = Model.SelectedMonth, page = Model.CurrentPage - 1 })">Previous</a>
                        </li>
                        <li class="page-item disabled"><span class="page-link">Page @Model.CurrentPage of @Model.TotalPages</span></li>
                        <li class="page-item @(Model.HasNextPage ? "" : "disabled")">
                            <a class="page-link" href="@Url.Action("Index","Payroll", new { searchTerm = Model.SearchTerm, status = Model.SelectedStatus, year = Model.SelectedYear, month = Model.SelectedMonth, page = Model.CurrentPage + 1 })">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</section>